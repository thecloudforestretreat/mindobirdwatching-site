<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MBW Admin | Dashboards</title>
  <meta name="robots" content="noindex, nofollow" />
  <meta name="theme-color" content="#034EA2" />
  <link rel="canonical" href="https://admin.mindobirdwatching.com/" />

  <!-- Favicons (must exist inside /admin output) -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- IMPORTANT:
       Because the admin Pages project publishes ONLY the /admin folder,
       these assets must be duplicated into /admin/assets/... in your repo.
  -->
  <link rel="stylesheet" href="/assets/css/site.css" />
  <link rel="stylesheet" href="/assets/css/header.css?v=1" />
  <script src="/assets/js/head.js" defer></script>

  <style>
    /* Page-only styles. site.css remains the source of truth for fonts/colors. */
    .page { margin-top: 18px; padding: 18px; }
    .page.card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }

    .adminTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }
    .adminTitle{ display:flex; align-items:flex-start; gap: 10px; min-width: 0; }
    .adminDot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #034EA2;
      box-shadow: 0 0 0 4px rgba(3,78,162,0.12);
      margin-top: 7px;
      flex: 0 0 auto;
    }
    .adminTitle h1{
      margin: 0;
      letter-spacing: -0.02em;
      line-height: 1.05;
      font-size: 18px;
    }
    .adminTitle p{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.5;
      max-width: 70ch;
    }

    .adminBadge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      font-weight: 900;
      font-size: 12.5px;
      color: var(--ink);
      line-height: 1;
      white-space: nowrap;
      margin-top: 10px;
    }
    .adminBadge i{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #034EA2;
      display:inline-block;
    }

    .adminControls{ display:flex; align-items:center; gap: 10px; flex-wrap: wrap; }

    .seg{
      display:flex;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .seg button{
      appearance:none;
      border:0;
      background: transparent;
      padding: 10px 14px;
      font-weight: 900;
      cursor:pointer;
      color: var(--ink);
      font-size: 14px;
      white-space: nowrap;
    }
    .seg button[aria-pressed="true"]{ background: rgba(3,78,162,0.12); }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      color: var(--ink);
      font-weight: 900;
    }
    .pill label{ color: var(--muted); font-size: 12.5px; font-weight: 900; white-space: nowrap; }
    .pill select{
      border:0;
      background: transparent;
      font-weight: 900;
      color: var(--ink);
      font-size: 14px;
      outline: none;
      cursor: pointer;
    }

    .btnLite{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      color: var(--ink);
      cursor:pointer;
      white-space: nowrap;
    }

    .panelHeader{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin: 10px 0 10px;
    }
    .panelHeader h2{
      margin:0;
      font-family: var(--font-head);
      color: var(--forest);
      letter-spacing: -0.02em;
      font-size: 18px;
    }
    .panelHeader .desc{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.5;
      max-width: 85ch;
    }
    .panelHeader a{
      font-weight: 900;
      color: #034EA2;
      text-decoration:none;
      white-space: nowrap;
      font-size: 13px;
    }
    .panelHeader a:hover{ text-decoration: underline; }

    .frameWrap{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .frameBox{
      width: 100%;
      height: min(76vh, 920px);
      position: relative;
      background: rgba(255,255,255,.55);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background: rgba(255,255,255,.55);
    }

    .cookieHint{
      border-top: 1px solid var(--line);
      padding: 12px 12px;
      background: rgba(255,255,255,.55);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .cookieHint p{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.5;
      max-width: 90ch;
    }
    .cookieHint .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .cookieHint .actions a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      text-decoration:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      color: var(--ink);
      white-space: nowrap;
    }

    /* Drawer */
    .scrim{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display:none;
      z-index: 80;
    }
    .drawer{
      position: fixed;
      right: 0;
      top: 0;
      width: min(420px, 92vw);
      height: 100%;
      background: #fff;
      border-left: 1px solid rgba(11,18,32,0.12);
      box-shadow: 0 18px 60px rgba(11,18,32,0.16);
      transform: translateX(100%);
      transition: transform 180ms ease-out;
      z-index: 90;
      display:flex;
      flex-direction: column;
    }
    .scrim.open{ display:block; }
    .drawer.open{ transform: translateX(0); }

    .drawerTop{
      padding: 14px;
      border-bottom: 1px solid rgba(11,18,32,0.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .drawerTop strong{ font-weight: 950; letter-spacing: -0.01em; }
    .drawerBody{ padding: 14px; overflow:auto; }
    .drawerBody h3{ margin: 0 0 8px; font-size: 13px; font-weight: 950; }
    .drawerBody p{ margin: 0 0 12px; color: var(--muted); font-size: 12.5px; line-height: 1.5; }
    .field{
      border: 1px solid rgba(11,18,32,0.12);
      border-radius: 16px;
      padding: 10px;
      background: rgba(246,248,251,0.75);
      margin-bottom: 10px;
    }
    .field label{
      display:block;
      font-size: 12px;
      font-weight: 950;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .field select{
      width: 100%;
      border: 1px solid rgba(11,18,32,0.12);
      border-radius: 12px;
      padding: 9px 10px;
      font-weight: 900;
      background: #fff;
      outline: none;
    }
    .drawerBottom{
      padding: 12px 14px;
      border-top: 1px solid rgba(11,18,32,0.10);
      display:flex;
      justify-content:flex-end;
      gap: 10px;
      flex-wrap: wrap;
      background: rgba(255,255,255,0.92);
    }

    @media (max-width: 900px){
      .page{ padding: 14px; }
      .frameBox{ height: 72vh; }
      .seg button{ padding: 10px 12px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="siteHeader"></div>

    <main class="page card" aria-label="MBW Admin">
      <div class="adminTop">
        <div class="adminTitle">
          <span class="adminDot" aria-hidden="true"></span>
          <div>
            <h1>MBW Admin</h1>
            <p>Private dashboards for KPIs, site, and social media. Data updates per connected sources.</p>
            <span class="adminBadge"><i aria-hidden="true"></i> Admin only</span>
          </div>
        </div>

        <div class="adminControls" aria-label="Admin controls">
          <div class="seg" role="group" aria-label="View">
            <button type="button" data-view="kpis" aria-pressed="true">KPIs</button>
            <button type="button" data-view="site" aria-pressed="false">Site</button>
            <button type="button" data-view="social" aria-pressed="false">Social Media</button>
          </div>

          <div class="pill" aria-label="Date preset">
            <label for="datePreset">Date</label>
            <select id="datePreset">
              <option value="all">All time</option>
              <option value="30" selected>Last 30 days</option>
              <option value="7">Last 7 days</option>
              <option value="mt">This month</option>
              <option value="ytd">Year to date</option>
            </select>
          </div>

          <button class="btnLite" type="button" id="openFilters">Filters</button>
        </div>
      </div>

      <div class="panelHeader">
        <div>
          <h2 id="panelTitle">KPIs</h2>
          <div class="desc" id="panelDesc">Revenue, margins, fees, tips, payouts, and upcoming tours.</div>
        </div>
        <a id="openInLooker" href="#" target="_blank" rel="noreferrer">Open in Looker</a>
      </div>

      <div class="frameWrap" aria-label="Embedded dashboard">
        <div class="frameBox">
          <iframe id="frame" title="MBW dashboard" src="" allowfullscreen loading="lazy"
            referrerpolicy="no-referrer"
            sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>
        </div>

        <div class="cookieHint" aria-label="Mobile access hint">
          <p>
            If you see "Can't access report" on iPhone, Safari is blocking Google third-party cookies.
            Use "Open in Looker" to view the report directly.
          </p>
          <div class="actions">
            <a id="openInLooker2" href="#" target="_blank" rel="noreferrer">Open in Looker</a>
          </div>
        </div>
      </div>
    </main>

    <div id="siteFooter"></div>
  </div>

  <div class="scrim" id="scrim" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-label="Filters panel" aria-hidden="true">
    <div class="drawerTop">
      <strong>Filters</strong>
      <button class="btnLite" type="button" id="closeFilters">Close</button>
    </div>
    <div class="drawerBody">
      <h3>Global</h3>
      <p>Date preset reloads the embed. Additional filters require URL parameter support inside Looker.</p>

      <div class="field">
        <label for="drawerDatePreset">Date preset</label>
        <select id="drawerDatePreset">
          <option value="all">All time</option>
          <option value="30" selected>Last 30 days</option>
          <option value="7">Last 7 days</option>
          <option value="mt">This month</option>
          <option value="ytd">Year to date</option>
        </select>
      </div>

      <div id="filterKpis">
        <h3>KPIs</h3>
        <div class="field">
          <label for="kTourStatus">Tour status</label>
          <select id="kTourStatus">
            <option value="all" selected>All</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
          </select>
        </div>
        <div class="field">
          <label for="kGuidePaid">Guide paid</label>
          <select id="kGuidePaid">
            <option value="all" selected>All</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
      </div>

      <div id="filterSite" style="display:none;">
        <h3>Site</h3>
        <div class="field">
          <label for="sDevice">Device</label>
          <select id="sDevice">
            <option value="all" selected>All</option>
            <option value="desktop">Desktop</option>
            <option value="mobile">Mobile</option>
            <option value="tablet">Tablet</option>
          </select>
        </div>
      </div>

      <div id="filterSocial" style="display:none;">
        <h3>Social</h3>
        <div class="field">
          <label for="smPlatform">Platform</label>
          <select id="smPlatform">
            <option value="all" selected>All</option>
            <option value="instagram">Instagram</option>
            <option value="youtube">YouTube</option>
          </select>
        </div>
      </div>
    </div>

    <div class="drawerBottom">
      <button class="btnLite" type="button" id="resetFilters">Reset</button>
      <button class="btnLite" type="button" id="applyFilters">Apply</button>
    </div>
  </aside>

  <!-- IMPORTANT:
       Because the admin Pages project publishes ONLY the /admin folder,
       these JS includes must be duplicated into /admin/assets/js/... in your repo.
  -->
  <script src="/assets/js/includes.js?v=1" defer></script>
  <script src="/assets/js/site.js?v=1" defer></script>

  <script>
    (function(){
      "use strict";

      var REPORTS = {
        kpis: "https://lookerstudio.google.com/embed/reporting/e9dd5771-63b2-4349-b33d-d56a2115d866/page/0HvmF",
        site: "https://lookerstudio.google.com/embed/reporting/1a0a112d-05c0-4b42-a55b-c70a9df099d1/page/bdXZF",
        social: "https://lookerstudio.google.com/embed/reporting/f2ce3a28-4438-4143-9fa1-480a9a3747bc/page/MABlF"
      };

      var VIEW_META = {
        kpis: { title: "KPIs", desc: "Revenue, margins, fees, tips, payouts, and upcoming tours." },
        site: { title: "Site", desc: "Website sessions, sources, devices, and conversions." },
        social: { title: "Social Media", desc: "Instagram and YouTube performance snapshots and trends." }
      };

      var currentView = "kpis";

      function setPressed(){
        var btns = document.querySelectorAll(".seg button[data-view]");
        for (var i = 0; i < btns.length; i++){
          var v = btns[i].getAttribute("data-view");
          btns[i].setAttribute("aria-pressed", (v === currentView) ? "true" : "false");
        }
      }

      function showView(){
        var meta = VIEW_META[currentView] || VIEW_META.kpis;
        document.getElementById("panelTitle").textContent = meta.title;
        document.getElementById("panelDesc").textContent = meta.desc;

        var link = REPORTS[currentView] || "#";
        document.getElementById("openInLooker").href = link;
        document.getElementById("openInLooker2").href = link;

        document.getElementById("filterKpis").style.display = (currentView === "kpis") ? "" : "none";
        document.getElementById("filterSite").style.display = (currentView === "site") ? "" : "none";
        document.getElementById("filterSocial").style.display = (currentView === "social") ? "" : "none";

        loadEmbed();
      }

      function getState(){
        return {
          datePreset: document.getElementById("datePreset").value,
          kTourStatus: document.getElementById("kTourStatus").value,
          kGuidePaid: document.getElementById("kGuidePaid").value,
          sDevice: document.getElementById("sDevice").value,
          smPlatform: document.getElementById("smPlatform").value
        };
      }

      function addParams(url, params){
        if(!url) return "";
        var hasQ = url.indexOf("?") >= 0;
        var parts = [];
        for (var k in params){
          if(!Object.prototype.hasOwnProperty.call(params, k)) continue;
          parts.push(encodeURIComponent(k) + "=" + encodeURIComponent(String(params[k])));
        }
        return url + (hasQ ? "&" : "?") + parts.join("&");
      }

      function buildParams(state){
        var p = { view: currentView, dp: state.datePreset };
        if(currentView === "kpis"){
          p.tour = state.kTourStatus;
          p.gpaid = state.kGuidePaid;
        }
        if(currentView === "site"){
          p.device = state.sDevice;
        }
        if(currentView === "social"){
          p.platform = state.smPlatform;
        }
        return p;
      }

      function loadEmbed(){
        var frame = document.getElementById("frame");
        var base = REPORTS[currentView] || "";
        var url = addParams(base, buildParams(getState()));
        frame.src = url;
      }

      function openDrawer(){
        document.getElementById("scrim").classList.add("open");
        document.getElementById("drawer").classList.add("open");
        document.getElementById("drawer").setAttribute("aria-hidden", "false");
        document.getElementById("scrim").setAttribute("aria-hidden", "false");
        document.getElementById("drawerDatePreset").value = document.getElementById("datePreset").value;
      }

      function closeDrawer(){
        document.getElementById("scrim").classList.remove("open");
        document.getElementById("drawer").classList.remove("open");
        document.getElementById("drawer").setAttribute("aria-hidden", "true");
        document.getElementById("scrim").setAttribute("aria-hidden", "true");
      }

      function resetDrawer(){
        document.getElementById("drawerDatePreset").value = "30";
        document.getElementById("kTourStatus").value = "all";
        document.getElementById("kGuidePaid").value = "all";
        document.getElementById("sDevice").value = "all";
        document.getElementById("smPlatform").value = "all";
      }

      function applyDrawer(){
        document.getElementById("datePreset").value = document.getElementById("drawerDatePreset").value;
        loadEmbed();
        closeDrawer();
      }

      function wire(){
        var btns = document.querySelectorAll(".seg button[data-view]");
        for (var i = 0; i < btns.length; i++){
          (function(btn){
            btn.addEventListener("click", function(){
              currentView = btn.getAttribute("data-view");
              setPressed();
              showView();
            });
          })(btns[i]);
        }

        document.getElementById("datePreset").addEventListener("change", loadEmbed);

        document.getElementById("openFilters").addEventListener("click", openDrawer);
        document.getElementById("closeFilters").addEventListener("click", closeDrawer);
        document.getElementById("scrim").addEventListener("click", closeDrawer);

        document.getElementById("resetFilters").addEventListener("click", resetDrawer);
        document.getElementById("applyFilters").addEventListener("click", applyDrawer);

        setPressed();
        showView();
      }

      document.addEventListener("DOMContentLoaded", wire);
    })();
  </script>
</body>
</html>
