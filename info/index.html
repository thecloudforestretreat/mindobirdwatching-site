<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Staff Info | Mindo Bird Watching</title>
  <meta name="robots" content="noindex,nofollow" />
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#034EA2">
  <link rel="stylesheet" href="/assets/css/site.css">
  <link rel="stylesheet" href="/assets/css/header.css?v=1">
  <script src="/assets/js/head.js" defer></script>

  <style>
    /* Page shell */
    .page{ margin-top:18px; padding:22px; width:100%; }
    .page.card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }

    /* Layout */
    .hero{
      display:grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, .9fr);
      gap:16px;
      align-items:start;
    }
    .hero > *{ min-width:0; }

    h1{ margin:0 0 8px; letter-spacing:-0.02em; }
    .lede{ margin:0; color: var(--ink); line-height: 1.65; max-width: 90ch; }

    .metaCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:10px;
    }

    .controls{
      display:grid;
      gap:10px;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .seg{
      display:inline-flex;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .seg button{
      appearance:none;
      border:0;
      background:transparent;
      padding: 10px 14px;
      font-weight: 950;
      cursor:pointer;
      color: var(--ink);
      font-size: 13px;
      line-height:1;
    }
    .seg button[aria-pressed="true"]{
      background: rgba(3,78,162,.12);
      color: var(--forest);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.55);
      font-weight: 950;
      color: var(--ink);
      font-size: 12.5px;
      line-height: 1;
      white-space: nowrap;
    }

    .field{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:10px;
      align-items:center;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.55);
      border-radius: 999px;
      box-shadow: var(--shadow);
      padding: 10px 12px;
    }
    .field label{
      font-weight: 950;
      color: var(--muted);
      font-size: 13px;
      line-height: 1;
    }
    .field select, .field input{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      font-weight: 900;
      color: var(--ink);
      font-size: 14px;
      line-height: 1.2;
      min-width: 0;
    }
    .field input::placeholder{ color: rgba(0,0,0,.35); font-weight:800; }

    .hint{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .asideCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:10px;
    }

    .asideTop{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .asideTop .btn{ margin:0; }

    .divider{
      margin-top: 16px;
      border-top: 1px solid var(--line);
      padding-top: 16px;
    }

    .contentGrid{
      display:grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 520px);
      gap:16px;
      align-items:start;
      margin-top: 14px;
    }
    .contentGrid > *{ min-width:0; }

    .listCard, .detailCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .listHead{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .listHead h2, .detailCard h2{
      margin:0;
      font-family: var(--font-head);
      color: var(--forest);
      letter-spacing:-0.02em;
      font-size: 18px;
      line-height:1.2;
      font-weight:950;
    }

    .items{
      list-style:none;
      margin:0;
      padding:0;
      display:grid;
      gap:10px;
    }

    .itemBtn{
      width:100%;
      text-align:left;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 12px 12px;
      cursor:pointer;
      display:grid;
      gap:4px;
    }
    .itemBtn:hover{ background: rgba(255,255,255,.75); }
    .itemBtn[aria-current="true"]{ outline: 2px solid rgba(3,78,162,.18); }

    .itemTitle{
      font-weight: 950;
      color: var(--ink);
      font-size: 14.5px;
      line-height:1.3;
      letter-spacing:-0.01em;
    }
    .itemSub{
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      font-weight: 800;
    }

    .replyBlock{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 12px;
      display:grid;
      gap:10px;
      margin-top: 10px;
    }

    .replyTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .replyTop h3{
      margin:0;
      font-weight: 950;
      color: var(--ink);
      font-size: 15px;
      letter-spacing:-0.01em;
    }

    .replyText{
      margin:0;
      color: var(--ink);
      line-height:1.7;
      font-size: 14px;
      white-space: pre-wrap;
      overflow-wrap: anywhere;
    }

    .socialList{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }

    .socialRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 10px 10px;
    }

    .socialLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .socialLeft img{
      width:28px;
      height:28px;
      object-fit:contain;
      flex: 0 0 auto;
    }
    .socialName{
      font-weight: 950;
      color: var(--ink);
      font-size: 14px;
      letter-spacing:-0.01em;
      line-height:1.2;
    }

    .promoWrap{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }
    .promoImg{
      width:100%;
      height:auto;
      border-radius: 16px;
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      display:block;
      background: rgba(255,255,255,.55);
    }
    .promoActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.9);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      color: var(--ink);
      font-size: 13px;
      z-index: 9999;
      display:none;
      max-width: min(520px, calc(100vw - 24px));
      text-align:center;
    }
    .toast.show{ display:block; }

    /* Responsive */
    @media (max-width: 1100px){
      .hero{ grid-template-columns: 1fr; }
      .contentGrid{ grid-template-columns: 1fr; }
    }

    @media (max-width: 640px){
      .page{ padding:16px; margin-top:14px; }
      .field{ grid-template-columns: 90px 1fr; }
      .seg button{ padding: 10px 12px; }
      .listCard, .detailCard, .metaCard, .asideCard{ padding: 12px; }
      .replyBlock{ padding: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="siteHeader"></div>

    <main class="page card">
      <section class="hero" aria-label="Staff info intro">
        <div class="heroLeft">
          <div>
            <h1>Staff Info</h1>
            <p class="lede">Use filters to find the right answer fast. Copy and paste short or detailed replies to chat or email.</p>
          </div>

          <div class="metaCard" aria-label="Filters">
            <div class="controls">
              <div class="row">
                <span class="pill">Language</span>
                <div class="seg" role="group" aria-label="Language toggle">
                  <button id="langEn" type="button" aria-pressed="true">English</button>
                  <button id="langEs" type="button" aria-pressed="false">Espanol</button>
                </div>
                <span id="statusPill" class="pill" aria-live="polite">Loading...</span>
              </div>

              <div class="row">
                <div class="field" style="flex: 1 1 260px;">
                  <label for="subjectSel">Subject</label>
                  <select id="subjectSel"></select>
                </div>
                <div class="field" style="flex: 1 1 260px;">
                  <label for="topicSel">Topic</label>
                  <select id="topicSel"></select>
                </div>
              </div>

              <div class="field">
                <label for="searchInp">Search</label>
                <input id="searchInp" type="search" placeholder="Search titles..." autocomplete="off" />
              </div>

              <p class="hint">Tip: click an item on the left to open copy buttons on the right.</p>
            </div>
          </div>
        </div>

        <aside class="asideCard" aria-label="Quick actions">
          <div class="asideTop">
            <a class="btn secondary" href="#" id="copyBookingBtn">Copy booking link</a>
          </div>
          <div class="hint" style="margin-top:2px;">
            Reservations: <strong>tours@mindobirdwatching.com</strong>
            <div style="height:6px;"></div>
            Tip: select a subject, then tap Copy to send a quick reply.
          </div>
        </aside>
      </section>

      <div class="divider"></div>

      <section class="contentGrid" aria-label="Results">
        <div class="listCard">
          <div class="listHead">
            <h2 id="listTitle">Items</h2>
            <span class="pill" id="countPill">0 items</span>
          </div>
          <ul class="items" id="itemsList"></ul>
        </div>

        <div class="detailCard" id="detailCard">
          <h2 id="detailTitle">Select an item</h2>
          <div id="detailBody"></div>
        </div>
      </section>
    </main>

    <div id="siteFooter"></div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    (function(){
      async function inject(id, url){
        const el = document.getElementById(id);
        if(!el) return;
        const res = await fetch(url, { cache: "no-store" });
        el.innerHTML = await res.text();
      }

      function loadScript(src){
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.defer = true;
          s.onload = resolve;
          s.onerror = reject;
          document.body.appendChild(s);
        });
      }

      function toast(msg){
        const el = document.getElementById("toast");
        if(!el) return;
        el.textContent = msg;
        el.classList.add("show");
        window.clearTimeout(toast._t);
        toast._t = window.setTimeout(() => el.classList.remove("show"), 1600);
      }

      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          toast("Copied");
          return true;
        }catch(e){
          try{
            const ta = document.createElement("textarea");
            ta.value = text;
            ta.setAttribute("readonly", "");
            ta.style.position = "fixed";
            ta.style.left = "-9999px";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            document.body.removeChild(ta);
            toast("Copied");
            return true;
          }catch(err){
            toast("Copy failed");
            return false;
          }
        }
      }

      function isImagePath(s){
        if(!s) return false;
        const v = String(s).trim();
        return /\.(png|jpg|jpeg|webp)$/i.test(v);
      }

      function absUrl(pathOrUrl){
        const v = String(pathOrUrl || "").trim();
        if(!v) return "";
        if(/^https?:\/\//i.test(v)) return v;
        return new URL(v.startsWith("/") ? v : ("/" + v), window.location.origin).href;
      }

      const iconMap = {
        "Instagram": "/assets/images/icons/MBW-IG.png",
        "TikTok": "/assets/images/icons/MBW-Social-TikTok.png",
        "Facebook": "/assets/images/icons/MBW-Social-FB-01.png",
        "YouTube": "/assets/images/icons/MBW-Social-YouTube.png",
        "Gift Shop": "/assets/images/icons/MBW-Social-Shopify.png",
        "Shop": "/assets/images/icons/MBW-Social-Shopify.png",
        "Google Reviews": "/assets/images/icons/Google-Review-Symbol.png",
        "Google Review Link": "/assets/images/icons/Google-Review-Symbol.png"
      };

      let DB = null;
      let lang = "en";
      let subject = "";
      let topic = "";
      let selected = null;

      const elStatus = () => document.getElementById("statusPill");
      const elSubject = () => document.getElementById("subjectSel");
      const elTopic = () => document.getElementById("topicSel");
      const elSearch = () => document.getElementById("searchInp");
      const elList = () => document.getElementById("itemsList");
      const elCount = () => document.getElementById("countPill");
      const elListTitle = () => document.getElementById("listTitle");
      const elDetailTitle = () => document.getElementById("detailTitle");
      const elDetailBody = () => document.getElementById("detailBody");

      function setLang(next){
        lang = next;
        document.getElementById("langEn").setAttribute("aria-pressed", lang === "en" ? "true" : "false");
        document.getElementById("langEs").setAttribute("aria-pressed", lang === "es" ? "true" : "false");
        selected = null;
        rebuildSubjects(true);
        render();
      }

      function currentBookingUrl(){
        return lang === "es" ? absUrl("/es/reservar-tour/") : absUrl("/book-tour/");
      }

      function rebuildSubjects(reset){
        const subjects = Object.keys(DB.languages[lang] || {});
        if(reset || !subjects.includes(subject)) subject = subjects[0] || "";
        const sel = elSubject();
        sel.innerHTML = subjects.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join("");
        sel.value = subject;
        rebuildTopics(true);
      }

      function rebuildTopics(reset){
        const topics = Object.keys((DB.languages[lang] && DB.languages[lang][subject]) || {});
        if(reset || !topics.includes(topic)) topic = topics[0] || "";
        const sel = elTopic();
        sel.innerHTML = topics.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join("");
        sel.value = topic;
      }

      function entries(){
        const list = (((DB.languages[lang] || {})[subject] || {})[topic] || []);
        const q = (elSearch().value || "").trim().toLowerCase();
        if(!q) return list;
        return list.filter(e => String(e.title || "").toLowerCase().includes(q));
      }

      function render(){
        const list = entries();
        elCount().textContent = `${list.length} ${list.length === 1 ? "item" : "items"}`;
        elListTitle().textContent = subject ? `${subject} - ${topic}` : "Items";

        const ul = elList();
        ul.innerHTML = "";
        list.forEach((e) => {
          const li = document.createElement("li");
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "itemBtn";
          btn.setAttribute("aria-current", selected && selected.id === e.id ? "true" : "false");
          btn.innerHTML = `
            <div class="itemTitle">${escapeHtml(e.title || "Untitled")}</div>
            <div class="itemSub">${escapeHtml(e.subtopic || "Overview")}</div>
          `;
          btn.addEventListener("click", () => {
            selected = e;
            render();
            renderDetail();
          });
          li.appendChild(btn);
          ul.appendChild(li);
        });

        if(!selected){
          renderDetail(); 
        } else {
          const stillExists = list.some(x => x.id === selected.id);
          if(!stillExists){
            selected = null;
            renderDetail();
          }
        }
      }

      function renderDetail(){
        const wrap = elDetailBody();
        wrap.innerHTML = "";
        if(!selected){
          elDetailTitle().textContent = "Select an item";
          // If Social Links exists, show a compact hint
          return;
        }

        elDetailTitle().textContent = selected.title || "Details";

        const shortMsg = selected.message_short || "";
        const longMsg = selected.message_long || "";
        const src = selected.source_url || "";

        if(shortMsg){
          wrap.appendChild(replyBlock("Short reply", shortMsg, "Copy short", () => copyText(shortMsg)));
        }
        if(longMsg){
          wrap.appendChild(replyBlock("Detailed reply", longMsg, "Copy detailed", () => copyText(longMsg)));
        }

        // Social links: hide URL text, show icon + name + copy
        if(subject === "Social" && topic === "Links"){
          const list = (((DB.languages[lang] || {})[subject] || {})[topic] || []);
          const box = document.createElement("div");
          box.className = "replyBlock";
          box.innerHTML = `
            <div class="replyTop">
              <h3>Social links</h3>
              <button class="btn secondary" type="button" id="copyAllSocial">Copy all</button>
            </div>
            <div class="socialList" id="socialList"></div>
          `;
          wrap.appendChild(box);

          const socialList = box.querySelector("#socialList");
          list.forEach((e) => {
            const name = e.title || "Link";
            const url = absUrl(e.source_url || e.message_short || "");
            const row = document.createElement("div");
            row.className = "socialRow";
            const icon = iconMap[name] || "/assets/images/icons/MBW-IG.png";
            row.innerHTML = `
              <div class="socialLeft">
                <img src="${icon}" alt="${escapeHtml(name)}" loading="lazy" decoding="async" />
                <div class="socialName">${escapeHtml(name)}</div>
              </div>
              <button class="btn secondary" type="button">Copy</button>
            `;
            row.querySelector("button").addEventListener("click", () => copyText(url));
            socialList.appendChild(row);
          });

          box.querySelector("#copyAllSocial").addEventListener("click", () => {
            const lines = list.map(e => {
              const name = e.title || "Link";
              const url = absUrl(e.source_url || e.message_short || "");
              return `${name}: ${url}`;
            });
            copyText(lines.join("\n"));
          });
        }

        // Promo images: show image + copy link button
        const promoUrl = absUrl(src || shortMsg);
        if(isImagePath(promoUrl)){
          const p = document.createElement("div");
          p.className = "promoWrap";
          p.innerHTML = `
            <div class="replyBlock">
              <div class="replyTop">
                <h3>Promo image</h3>
                <div class="promoActions">
                  <button class="btn secondary" type="button" id="copyImgLink">Copy image link</button>
                  <a class="btn secondary" id="openImg" href="${promoUrl}" target="_blank" rel="noopener">Open image</a>
                </div>
              </div>
              <p class="hint" style="margin:0;">Tip: on mobile, long-press the image to copy or save it.</p>
              <img class="promoImg" src="${promoUrl}" alt="Promo image" loading="lazy" decoding="async" />
            </div>
          `;
          p.querySelector("#copyImgLink").addEventListener("click", () => copyText(promoUrl));
          wrap.appendChild(p);
        }
      }

      function replyBlock(title, text, btnLabel, onCopy){
        const div = document.createElement("div");
        div.className = "replyBlock";
        div.innerHTML = `
          <div class="replyTop">
            <h3>${escapeHtml(title)}</h3>
            <button class="btn secondary" type="button">${escapeHtml(btnLabel)}</button>
          </div>
          <p class="replyText">${escapeHtml(text)}</p>
        `;
        div.querySelector("button").addEventListener("click", onCopy);
        return div;
      }

      function escapeHtml(s){
        return String(s ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      async function init(){
        await inject("siteHeader", "/assets/includes/header.html");
        await inject("siteFooter", "/assets/includes/footer.html");
        await loadScript("/assets/js/site.js");

        document.getElementById("langEn").addEventListener("click", () => setLang("en"));
        document.getElementById("langEs").addEventListener("click", () => setLang("es"));

        document.getElementById("copyBookingBtn").addEventListener("click", (e) => {
          e.preventDefault();
          copyText(currentBookingUrl());
        });

        elSubject().addEventListener("change", () => {
          subject = elSubject().value;
          selected = null;
          rebuildTopics(true);
          render();
        });

        elTopic().addEventListener("change", () => {
          topic = elTopic().value;
          selected = null;
          render();
        });

        elSearch().addEventListener("input", () => {
          selected = null;
          render();
        });

        try{
          elStatus().textContent = "Loading...";
          const res = await fetch("./staff-content.json", { cache: "no-store" });
          DB = await res.json();
          elStatus().textContent = "Ready";
          rebuildSubjects(true);
          render();
        }catch(err){
          console.error(err);
          elStatus().textContent = "Failed";
          toast("Failed to load staff-content.json");
        }
      }

      init();
    })();
  </script>
</body>
</html>
