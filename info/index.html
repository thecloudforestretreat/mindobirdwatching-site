<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Staff Info | Mindo Bird Watching</title>
  <meta name="description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <link rel="canonical" href="https://staging.mindobirdwatching.com/info/" />
  <link rel="alternate" hreflang="en" href="/info/" />
  <link rel="alternate" hreflang="es" href="/info/" />

  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Mindo Bird Watching" />
  <meta property="og:title" content="Staff Info | Mindo Bird Watching" />
  <meta property="og:description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <meta property="og:url" content="https://staging.mindobirdwatching.com/info/" />
  <meta property="og:image" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />
  <meta property="og:image:secure_url" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Mindo Bird Watching - guided birding tours in Ecuador's cloud forest" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Staff Info | Mindo Bird Watching" />
  <meta name="twitter:description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <meta name="twitter:image" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#034EA2">

  <link rel="stylesheet" href="/assets/css/site.css">
  <link rel="stylesheet" href="/assets/css/header.css?v=1">
  <script src="/assets/js/head.js" defer></script>

  <style>
    *{ box-sizing: border-box; }
    img{ max-width: 100%; height: auto; }

    .page{ margin-top:18px; padding:26px; }
    .page.card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }
    h1{ margin:0 0 8px; letter-spacing:-0.02em; }
    .lede{ margin:0; max-width: 92ch; color: var(--ink); line-height: 1.65; }

    .metaCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:12px;
    }

    .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

    .chip{
      display:inline-flex;
      align-items:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.55);
      font-weight: 900;
      color: var(--ink);
      font-size: 12.5px;
      line-height: 1;
      white-space: nowrap;
    }

    .note{ margin:0; color: var(--muted); font-size: 13px; line-height: 1.55; }

    .seg{
      display:inline-flex;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .seg button{
      appearance:none;
      border:0;
      background:transparent;
      padding: 10px 14px;
      font-weight: 950;
      font-size: 12.5px;
      color: var(--ink);
      cursor:pointer;
      line-height: 1;
      min-height: 40px;
    }
    .seg button[aria-pressed="true"]{
      background: rgba(3,78,162,.10);
      color: var(--forest);
    }

    .filters{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .filterPill{
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 8px 12px;
      display:flex;
      align-items:center;
      gap: 10px;
      min-height: 44px;
      min-width: 0;
    }

    .filterPill label{
      font-weight: 900;
      font-size: 12.5px;
      color: var(--muted);
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .filterPill select,
    .filterPill input{
      border: 0;
      outline: 0;
      background: transparent;
      color: var(--ink);
      font-weight: 900;
      width: 100%;
      padding: 0;
      height: 28px;
      line-height: 28px;
      min-width: 0;
    }

    .actionsCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:10px;
    }

    .actionTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btnRow .btn{ flex: 0 0 auto; }

    .section{
      margin-top:18px;
      padding-top:14px;
      border-top: 1px solid var(--line);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr .95fr;
      gap: 14px;
      align-items:start;
    }

    .list{
      display:grid;
      gap: 10px;
      min-width: 0;
    }

    .itemBtn{
      width:100%;
      text-align:left;
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 12px 12px;
      cursor:pointer;
      display:grid;
      gap:6px;
      min-width: 0;
    }

    .itemBtn[aria-current="true"]{
      outline: 2px solid rgba(3,78,162,.25);
      outline-offset: 0;
    }

    .itemTitle{
      margin:0;
      font-weight: 950;
      letter-spacing:-0.01em;
      color: var(--ink);
      font-size: 14px;
      line-height: 1.35;
      word-break: break-word;
    }

    .itemMeta{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
    }

    .detail{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap: 12px;
      position: sticky;
      top: 92px;
      min-width: 0;
    }

    .detail h2{
      margin:0;
      font-family: var(--font-head);
      color: var(--forest);
      letter-spacing:-0.02em;
      font-size: 18px;
      line-height: 1.25;
      font-weight: 950;
      word-break: break-word;
    }

    .block{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      padding: 12px;
      display:grid;
      gap: 8px;
      min-width: 0;
    }

    .blockHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .blockTitle{
      margin:0;
      font-weight: 950;
      color: var(--ink);
      font-size: 13px;
      letter-spacing:-0.01em;
    }

    .copyBtn{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      border-radius: 999px;
      padding: 8px 10px;
      font-weight: 950;
      font-size: 12.5px;
      cursor:pointer;
      line-height: 1;
      white-space: nowrap;
    }

    .copyBtn:focus-visible{
      outline: 2px solid rgba(3,78,162,.35);
      outline-offset: 2px;
    }

    .txt{
      margin:0;
      color: var(--ink);
      line-height: 1.7;
      font-size: 14px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .empty{
      border: 1px dashed var(--line);
      border-radius: var(--r);
      padding: 12px;
      background: rgba(255,255,255,.45);
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
    }

    /* Promo image */
    .promoFigure{ margin:0; display:grid; gap:10px; }
    .promoImg{
      width:100%;
      height:auto;
      max-height: 340px;
      object-fit: contain;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
    }
    .promoBtnRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    /* Social rows (icon + label only) */
    .socialGrid{ display:grid; gap:10px; }
    .socialRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 10px 10px;
      background: rgba(255,255,255,.55);
      min-width: 0;
    }
    .socialLeft{ display:flex; gap:10px; align-items:center; min-width:0; }
    .socialIcon{ width:28px; height:28px; object-fit:contain; flex:0 0 auto; }
    .socialName{
      font-weight: 950;
      color: var(--ink);
      font-size: 14px;
      line-height: 1.2;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 900;
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
      z-index: 9999;
      max-width: calc(100vw - 32px);
      text-align: center;
    }
    .toast.show{ opacity: 1; }

    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .detail{ position: relative; top: 0; }
    }

    @media (max-width: 640px){
      .page{ padding:16px; margin-top:14px; }
      .filters{ grid-template-columns: 1fr; }
      .detail{ padding:12px; }
      .block{ padding: 10px; }
      .promoImg{ max-height: 260px; }
      .socialIcon{ width:26px; height:26px; }
    }
  
    /* v4 UX refinements */
    .itemGrid{ display:grid; grid-template-columns: 1fr; gap:10px; }
    @media (min-width: 901px){
      .itemGrid{ grid-template-columns: 1fr; }
    }
    .pickerRow{ display:flex; }
    .qPicker{
      width:100%;
      height:44px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 0 14px;
      font-weight: 900;
      color: var(--ink);
    }

    .msgCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:10px;
      margin-top: 12px;
      min-width: 0;
    }
    .msgTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .msgLabel{
      font-weight: 950;
      color: var(--forest);
      letter-spacing: -0.01em;
      font-size: 13px;
    }
    .msgActions{ display:flex; gap:10px; flex-wrap:wrap; }
    .msgBody pre{
      margin:0;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere;
      font-family: var(--font-body);
      font-size: 14px;
      line-height: 1.65;
      color: var(--ink);
    }
    .msgHint{
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.5;
      margin-top: 2px;
    }
    .promoFrame{
      width:100%;
      max-width: 520px;
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      overflow:hidden;
    }
    .promoImg{
      width:100%;
      height:auto;
      display:block;
    }

    .socialGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 901px){
      .socialGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .socialGrid.compact{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    .socialCard{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      min-width: 0;
    }
    .socialLeft{ display:flex; align-items:center; gap:10px; min-width: 0; }
    .socialIcon{ width: 26px; height: 26px; object-fit: contain; display:block; }
    .socialName{
      font-weight: 950;
      color: var(--ink);
      font-size: 13.5px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .isCopied{ opacity: .9; }

    @media (max-width: 900px){
      .promoFrame{ max-width: 100%; }
      .msgActions .btn{ flex: 1 1 140px; }
      .socialGrid.compact{ grid-template-columns: 1fr; }
      .socialCard{ padding: 12px; }
    }
</style>
</head>
<body>
  <div class="container">
    <div id="siteHeader"></div>

    <main class="page card" aria-label="Staff info">
      <section class="hero" aria-label="Staff info introduction">
        <div>
          <h1 id="pageTitle">Staff Info</h1>
          <p class="lede" id="pageLede">Use filters to find the right answer fast. Copy and paste short or detailed replies to chat or email.</p>

          <div class="metaCard" aria-label="Controls">
            <div class="row">
              <div class="chips" aria-label="Language">
                <span class="chip" id="langLabel">Language</span>
                <div class="seg" role="group" aria-label="Language toggle">
                  <button id="langEn" type="button" aria-pressed="true">English</button>
                  <button id="langEs" type="button" aria-pressed="false">Espa√±ol</button>
                </div>
              </div>

              <div class="chips" aria-label="Status">
                <span class="chip" id="statusChip">Loading...</span>
                <span class="chip"><span id="count">0</span> items</span>
              </div>
            </div>

            <div class="filters" aria-label="Filters">
              <div class="filterPill">
                <label for="subjectSel" id="subjectLabel">Subject</label>
                <select id="subjectSel"></select>
              </div>

              <div class="filterPill">
                <label for="topicSel" id="topicLabel">Topic</label>
                <select id="topicSel"></select>
              </div>

              <div class="filterPill" style="grid-column: 1 / -1;">
                <label for="q" id="searchLabel">Search</label>
                <input id="q" type="search" placeholder="Search titles..." autocomplete="off" />
              </div>
            </div>

            <p class="note" id="hint">Tip: select a subject, then tap Copy to send a quick reply.</p>
          </div>
        </div>

        <aside class="actionsCard" aria-label="Quick actions">
          <div class="actionTop">
            <span class="chip" id="quickTitle">Quick actions</span>
            <button class="btn secondary" type="button" id="copyBookingLink">Copy booking link</button>
          </div>
          <p class="note" id="reservationsLine">Reservations: <strong>tours@mindobirdwatching.com</strong></p>
          <p class="note" id="quickTip">If a guest asks for prices, confirm the date and group size.</p>
        </aside>
      </section>

      <section class="section" aria-label="Results">
        <div class="grid">
          <div class="list" id="list" aria-label="Items list"></div>

          <aside class="detail" aria-label="Item detail">
            <h2 id="detailTitle">Select an item</h2>
            <div id="blocks"></div>
          </aside>
        </div>
      </section>
    </main>

    <div id="siteFooter"></div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
(function(){
  "use strict";

  const DATA_URL = "./staff-content.json";
  const els = {
    lang: document.getElementById("lang"),
    subject: document.getElementById("subject"),
    topic: document.getElementById("topic"),
    list: document.getElementById("list"),
    detail: document.getElementById("detail"),
    status: document.getElementById("status"),
    bookingBtn: document.getElementById("copyBookingLink")
  };

  const STR = {
    en: {
      title: "Staff Info",
      statusLoading: "Loading content...",
      statusReady: "Ready.",
      statusNoItems: "No items found for this selection.",
      langLabel: "Language",
      subjectLabel: "Subject",
      topicLabel: "Topic",
      selectSubject: "Select a subject",
      selectTopic: "Select a topic",
      selectItem: "Select an item",
      items: "Items",
      copy: "Copy",
      copied: "Copied",
      copyShort: "Copy short",
      copyLong: "Copy long",
      copyAnswer: "Copy answer",
      copyLink: "Copy link",
      open: "Open",
      copyImage: "Copy image",
      imageHelp: "Tip: on mobile, long-press the image to share or save.",
      bookingLink: "Copy booking link",
      bookingPath: "/book-a-tour/",
      questions: "Questions",
      social: "Social",
      socialLinks: "Social links",
      promoImages: "Promo images"
    },
    es: {
      title: "Info del equipo",
      statusLoading: "Cargando contenido...",
      statusReady: "Listo.",
      statusNoItems: "No hay elementos para esta seleccion.",
      langLabel: "Idioma",
      subjectLabel: "Tema",
      topicLabel: "Categoria",
      selectSubject: "Selecciona un tema",
      selectTopic: "Selecciona una categoria",
      selectItem: "Selecciona una opcion",
      items: "Opciones",
      copy: "Copiar",
      copied: "Copiado",
      copyShort: "Copiar corto",
      copyLong: "Copiar largo",
      copyAnswer: "Copiar respuesta",
      copyLink: "Copiar enlace",
      open: "Abrir",
      copyImage: "Copiar imagen",
      imageHelp: "Consejo: en movil, manten presionada la imagen para compartir o guardar.",
      bookingLink: "Copiar enlace de reserva",
      bookingPath: "/es/reservar-tour/",
      questions: "Preguntas",
      social: "Social",
      socialLinks: "Redes sociales",
      promoImages: "Imagenes promocionales"
    }
  };

  const SUBJECT_LABELS = {
    en: { "Tours":"Tours", "Activities":"Activities", "Questions":"Questions", "Transportation":"Transportation", "Social":"Social" },
    es: { "Tours":"Tours", "Activities":"Actividades", "Questions":"Preguntas", "Transportation":"Transporte", "Social":"Redes" }
  };

  const ICONS = {
    "Instagram": "/assets/images/icons/MBW-IG.png",
    "Facebook": "/assets/images/icons/MBW-Social-FB-01.png",
    "TikTok": "/assets/images/icons/MBW-Social-TikTok.png",
    "YouTube": "/assets/images/icons/MBW-Social-YouTube.png",
    "Gift Shop": "/assets/images/icons/MBW-Social-Shopify.png",
    "Tienda": "/assets/images/icons/MBW-Social-Shopify.png",
    "Google Reviews": "/assets/images/icons/Google-Review-Symbol.png",
    "Resenas de Google": "/assets/images/icons/Google-Review-Symbol.png"
  };

  let raw = null;
  const state = {
    lang: "en",
    subject: "",
    topic: "",
    itemId: ""
  };

  function absUrl(path){
    if(!path) return "";
    const p = String(path).trim();
    if(/^https?:\/\//i.test(p)) return p;
    // handle leading slash and relative
    const base = window.location.origin.replace(/\/$/, "");
    if(p.startsWith("/")) return base + p;
    return base + "/" + p;
  }

  function esc(s){
    return String(s || "")
      .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
  }

  function setStatus(msg){
    if(els.status) els.status.textContent = msg;
  }

  function t(key){
    const dict = STR[state.lang] || STR.en;
    return dict[key] || key;
  }

  function copyText(text){
    const val = String(text || "");
    if(!val) return Promise.resolve(false);

    // Prefer async clipboard
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(val).then(() => true).catch(() => fallbackCopy(val));
    }
    return fallbackCopy(val);
  }

  function fallbackCopy(val){
    try{
      const ta = document.createElement("textarea");
      ta.value = val;
      ta.setAttribute("readonly","readonly");
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      ta.style.top = "0";
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return Promise.resolve(!!ok);
    }catch(_){
      return Promise.resolve(false);
    }
  }

  async function copyImageFromUrl(url){
    const u = absUrl(url);
    if(!u) return false;
    if(!navigator.clipboard || !window.ClipboardItem) return false;

    try{
      const res = await fetch(u, { cache: "no-store" });
      const blob = await res.blob();
      const mime = blob.type || "image/jpeg";
      const item = new ClipboardItem({ [mime]: blob });
      await navigator.clipboard.write([item]);
      return true;
    }catch(_){
      return false;
    }
  }

  function flash(btn){
    if(!btn) return;
    const old = btn.textContent;
    btn.textContent = t("copied");
    btn.classList.add("isCopied");
    setTimeout(() => {
      btn.textContent = old;
      btn.classList.remove("isCopied");
    }, 900);
  }

  function normalizeData(obj){
    // Ensure we do not reintroduce $$ anywhere
    const s = JSON.stringify(obj);
    const cleaned = s.replace(/\$\$/g, "$");
    return JSON.parse(cleaned);
  }

  function getBucket(){
    if(!raw) return null;
    const langBucket = raw.languages && raw.languages[state.lang];
    return langBucket || null;
  }

  function getSubjects(){
    const bucket = getBucket();
    if(!bucket) return [];
    return Object.keys(bucket).filter(k => !k.startsWith("_"));
  }

  function getTopics(){
    const bucket = getBucket();
    if(!bucket || !state.subject) return [];
    const subj = bucket[state.subject];
    if(!subj) return [];
    return Object.keys(subj).filter(k => !k.startsWith("_"));
  }

  function collectItems(){
    const bucket = getBucket();
    if(!bucket || !state.subject || !state.topic) return [];
    const arr = bucket[state.subject][state.topic] || [];
    return (Array.isArray(arr) ? arr : []).map((it, i) => {
      const id = it.id ? String(it.id) : (state.subject + "|" + state.topic + "|" + i);
      return Object.assign({}, it, { _id: id, _i: i });
    });
  }

  function setBookingBtn(){
    if(!els.bookingBtn) return;
    els.bookingBtn.textContent = t("bookingLink");
    const link = absUrl(t("bookingPath"));
    els.bookingBtn.onclick = async function(){
      const ok = await copyText(link);
      if(ok) flash(els.bookingBtn);
    };
  }

  function renderSubjectOptions(){
    const subs = getSubjects();
    const labels = SUBJECT_LABELS[state.lang] || SUBJECT_LABELS.en;

    els.subject.innerHTML = `<option value="">${esc(t("selectSubject"))}</option>` +
      subs.map(s => `<option value="${esc(s)}">${esc(labels[s] || s)}</option>`).join("");

    // keep selection if still valid
    if(subs.includes(state.subject)) els.subject.value = state.subject;
    else els.subject.value = "";
  }

  function renderTopicOptions(){
    const topics = getTopics();

    els.topic.innerHTML = `<option value="">${esc(t("selectTopic"))}</option>` +
      topics.map(tp => `<option value="${esc(tp)}">${esc(tp)}</option>`).join("");

    if(topics.includes(state.topic)) els.topic.value = state.topic;
    else els.topic.value = "";
  }

  function renderListAndDetail(){
    const items = collectItems();
    const isQuestions = (state.subject === "Questions");
    const isSocial = (state.subject === "Social");

    // If Social: show everything immediately and hide list
    if(isSocial){
      els.list.innerHTML = "";
      els.list.setAttribute("hidden","hidden");
      els.detail.innerHTML = renderSocial(items);
      return;
    }

    els.list.removeAttribute("hidden");

    // On mobile for Questions: show dropdown for items (answer stays near top)
    const isMobile = window.matchMedia("(max-width: 900px)").matches;

    if(isQuestions && isMobile){
      els.list.innerHTML = renderQuestionPicker(items);
    }else{
      els.list.innerHTML = renderItemButtons(items);
    }

    // default selected item
    let selected = items.find(it => it._id === state.itemId) || items[0] || null;
    if(selected) state.itemId = selected._id;
    els.detail.innerHTML = selected ? renderItem(selected) : renderEmpty();

    bindListEvents(items, isQuestions && isMobile);
    bindDetailEvents();

    // For questions on mobile, keep detail in view after change
    if(isQuestions && isMobile){
      const d = els.detail;
      if(d) d.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }

  function renderEmpty(){
    return `<div class="cardEmpty">${esc(t("statusNoItems"))}</div>`;
  }

  function renderItemButtons(items){
    if(!items.length) return `<div class="listEmpty">${esc(t("statusNoItems"))}</div>`;
    return `
      <div class="listHead">${esc(t("items"))}</div>
      <div class="itemGrid">
        ${items.map(it => {
          const title = it.title || it.name || it.label || ("Item " + (it._i+1));
          const active = (it._id === state.itemId) ? " isActive" : "";
          return `<button class="itemBtn${active}" data-item="${esc(it._id)}" type="button">${esc(title)}</button>`;
        }).join("")}
      </div>
    `;
  }

  function renderQuestionPicker(items){
    if(!items.length) return `<div class="listEmpty">${esc(t("statusNoItems"))}</div>`;
    return `
      <div class="listHead">${esc(t("selectItem"))}</div>
      <div class="pickerRow">
        <select id="qPicker" class="qPicker" aria-label="${esc(t("selectItem"))}">
          ${items.map(it => {
            const title = it.title || it.name || it.label || ("Item " + (it._i+1));
            const sel = (it._id === state.itemId) ? " selected" : "";
            return `<option value="${esc(it._id)}"${sel}>${esc(title)}</option>`;
          }).join("")}
        </select>
      </div>
    `;
  }

  function renderSocial(items){
    const dict = STR[state.lang] || STR.en;
    if(!items.length) return renderEmpty();

    return `
      <div class="detailHead">
        <h2 class="detailTitle">${esc(dict.socialLinks)}</h2>
        <p class="detailHint">${esc(state.lang === "es" ? "Toca copiar para enviar en un mensaje." : "Tap copy to send in a message.")}</p>
      </div>
      <div class="socialGrid">
        ${items.map(it => {
          const name = it.title || it.name || it.label || "";
          const url = it.url || it.link || it.value || it.source_url || it.message_long || it.message_short || "";
          const icon = ICONS[name] || ICONS[(state.lang==="es" && name.toLowerCase().includes("resena")) ? "Resenas de Google" : name] || "";
          return `
            <div class="socialCard">
              <div class="socialLeft">
                ${icon ? `<img class="socialIcon" src="${esc(icon)}" alt="" aria-hidden="true" />` : `<span class="socialIconFallback" aria-hidden="true"></span>`}
                <div class="socialName">${esc(name)}</div>
              </div>
              <button class="btn secondary copyBtn" data-copy="${esc(url)}" type="button">${esc(t("copy"))}</button>
            </div>
          `;
        }).join("")}
      </div>
    `;
  }

  function renderItem(it){
    const title = it.title || it.name || it.label || "";
    const shortMsg = (it.message_short || "").trim();
    const longMsg = (it.message_long || "").trim();
    const promo = (it.promo_image || it.image || it.promo || it.source_url || "").trim();
    const promoAbs = promo ? absUrl(promo) : "";

    const blocks = [];

    if(title){
      blocks.push(`<div class="detailHead"><h2 class="detailTitle">${esc(title)}</h2></div>`);
    }

    if(shortMsg){
      blocks.push(renderMessageBlock("short", shortMsg));
    }

    if(longMsg){
      blocks.push(renderMessageBlock("long", longMsg));
    }

    // Promo image block (for tours)
    if(promoAbs){
      blocks.push(`
        <div class="msgCard">
          <div class="msgTop">
            <div class="msgLabel">${esc(t("promoImages"))}</div>
            <div class="msgActions">
              <button class="btn secondary copyBtn" data-copy="${esc(promoAbs)}" type="button">${esc(t("copyLink"))}</button>
              <button class="btn secondary copyImgBtn" data-copy-img="${esc(promoAbs)}" type="button">${esc(t("copyImage"))}</button>
              <a class="btn secondary" href="${esc(promoAbs)}" target="_blank" rel="noopener">${esc(t("open"))}</a>
            </div>
          </div>
          <div class="promoFrame">
            <img class="promoImg" src="${esc(promoAbs)}" alt="" loading="lazy" decoding="async" />
          </div>
          <div class="msgHint">${esc(t("imageHelp"))}</div>
        </div>
      `);
    }

    // Social footer always visible as a quick copy area
    blocks.push(`<div class="divider"></div>`);
    blocks.push(`<div id="socialInline"></div>`);

    return blocks.join("");
  }

  function renderMessageBlock(kind, text){
    const label = (state.subject === "Questions")
      ? t("copyAnswer")
      : (kind === "short" ? t("copyShort") : t("copyLong"));

    return `
      <div class="msgCard">
        <div class="msgTop">
          <div class="msgLabel">${esc(kind === "short" ? (state.lang==="es" ? "Mensaje corto" : "Short message") : (state.lang==="es" ? "Mensaje largo" : "Long message"))}</div>
          <div class="msgActions">
            <button class="btn secondary copyBtn" data-copy="${esc(text)}" type="button">${esc(label)}</button>
          </div>
        </div>
        <div class="msgBody"><pre>${esc(text)}</pre></div>
      </div>
    `;
  }

  function bindListEvents(items, isPicker){
    if(isPicker){
      const sel = document.getElementById("qPicker");
      if(!sel) return;
      sel.addEventListener("change", () => {
        state.itemId = sel.value;
        const it = items.find(x => x._id === state.itemId);
        els.detail.innerHTML = it ? renderItem(it) : renderEmpty();
        bindDetailEvents();
        renderSocialInline();
        els.detail.scrollIntoView({ behavior: "smooth", block: "start" });
      });
      return;
    }

    els.list.querySelectorAll("[data-item]").forEach(btn => {
      btn.addEventListener("click", () => {
        state.itemId = btn.getAttribute("data-item") || "";
        els.list.querySelectorAll(".itemBtn").forEach(b => b.classList.remove("isActive"));
        btn.classList.add("isActive");

        const it = items.find(x => x._id === state.itemId);
        els.detail.innerHTML = it ? renderItem(it) : renderEmpty();
        bindDetailEvents();
        renderSocialInline();

        // Always bring the answer into view on mobile
        if(window.matchMedia("(max-width: 900px)").matches){
          els.detail.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });
  }

  function bindDetailEvents(){
    els.detail.querySelectorAll(".copyBtn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const txt = btn.getAttribute("data-copy") || "";
        const ok = await copyText(txt);
        if(ok) flash(btn);
      });
    });

    els.detail.querySelectorAll(".copyImgBtn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const url = btn.getAttribute("data-copy-img") || "";
        const ok = await copyImageFromUrl(url);
        if(ok) flash(btn);
        else{
          // fallback: copy the link
          const ok2 = await copyText(absUrl(url));
          if(ok2) flash(btn);
        }
      });
    });
  }

  function renderSocialInline(){
    const holder = document.getElementById("socialInline");
    if(!holder || !raw) return;

    const bucket = getBucket();
    const socials = (bucket && bucket.Social) ? bucket.Social : null;
    if(!socials){
      holder.innerHTML = "";
      return;
    }

    // Flatten all topics under Social
    const items = [];
    Object.keys(socials).forEach(tp => {
      (socials[tp] || []).forEach((it, i) => items.push(Object.assign({}, it, { _id: "social|" + tp + "|" + i })));
    });

    const title = (state.lang === "es") ? "Redes sociales" : "Social links";

    holder.innerHTML = `
      <div class="detailHead" style="margin-bottom:10px;">
        <h3 class="detailTitle" style="font-size:16px;">${esc(title)}</h3>
      </div>
      <div class="socialGrid compact">
        ${items.map(it => {
          const name = it.title || it.name || it.label || "";
          const url = it.url || it.link || it.value || it.source_url || it.message_long || it.message_short || "";
          const icon = ICONS[name] || "";
          return `
            <div class="socialCard">
              <div class="socialLeft">
                ${icon ? `<img class="socialIcon" src="${esc(icon)}" alt="" aria-hidden="true" />` : `<span class="socialIconFallback" aria-hidden="true"></span>`}
                <div class="socialName">${esc(name)}</div>
              </div>
              <button class="btn secondary copyBtn" data-copy="${esc(url)}" type="button">${esc(t("copy"))}</button>
            </div>
          `;
        }).join("")}
      </div>
    `;

    bindDetailEvents();
  }

  function bindTopControls(){
    els.lang.addEventListener("change", () => {
      state.lang = els.lang.value;
      state.subject = "";
      state.topic = "";
      state.itemId = "";
      setBookingBtn();
      renderAll();
    });

    els.subject.addEventListener("change", () => {
      state.subject = els.subject.value;
      state.topic = "";
      state.itemId = "";
      renderAll();
    });

    els.topic.addEventListener("change", () => {
      state.topic = els.topic.value;
      state.itemId = "";
      renderAll();
    });

    window.addEventListener("resize", () => {
      // re-render list style (picker vs buttons) when crossing breakpoint
      renderListAndDetail();
      renderSocialInline();
    });
  }

  function renderAll(){
    // Translate static labels
    document.getElementById("pageTitle").textContent = t("title");
    document.getElementById("langLabel").textContent = t("langLabel");
    document.getElementById("subjectLabel").textContent = t("subjectLabel");
    document.getElementById("topicLabel").textContent = t("topicLabel");

    renderSubjectOptions();
    renderTopicOptions();

    // Hide topic picker for Social (one-tap access to all links)
    const topicField = els.topic ? els.topic.closest(".field") : null;
    if(topicField){
      if(state.subject === "Social") topicField.setAttribute("hidden","hidden");
      else topicField.removeAttribute("hidden");
    }

    // When subject changes, rebuild topics and default first topic if needed
    const topics = getTopics();
    if(state.subject && !state.topic && topics.length) state.topic = topics[0];
    if(state.topic && !topics.includes(state.topic)) state.topic = topics[0] || "";

    renderTopicOptions();

    // If no subject or topic selected yet
    if(!state.subject || !state.topic){
      els.list.innerHTML = "";
      els.detail.innerHTML = `<div class="cardEmpty">${esc(t("selectSubject"))}</div>`;
      renderSocialInline();
      return;
    }

    renderListAndDetail();
    renderSocialInline();
  }

  async function init(){
    try{
      setStatus(t("statusLoading"));
      const res = await fetch(DATA_URL, { cache: "no-store" });
      const json = await res.json();
      raw = normalizeData(json);

      // default language from selector if present
      state.lang = (els.lang && els.lang.value) ? els.lang.value : "en";

      setBookingBtn();
      bindTopControls();
      setStatus(t("statusReady"));

      renderAll();
    }catch(_){
      setStatus("Content unavailable.");
    }
  }

  init();
})();
</script>
</body>
</html>
