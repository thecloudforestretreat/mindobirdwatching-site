<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Staff Info | Mindo Bird Watching</title>
  <meta name="description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <link rel="canonical" href="https://staging.mindobirdwatching.com/info/" />

  <link rel="alternate" hreflang="en" href="/info/" />
  <link rel="alternate" hreflang="es" href="/info/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Mindo Bird Watching" />
  <meta property="og:title" content="Staff Info | Mindo Bird Watching" />
  <meta property="og:description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <meta property="og:url" content="https://staging.mindobirdwatching.com/info/" />
  <meta property="og:image" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />
  <meta property="og:image:secure_url" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Mindo Bird Watching - guided birding tours in Ecuador's cloud forest" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Staff Info | Mindo Bird Watching" />
  <meta name="twitter:description" content="Private staff reference page for quick tour, activity, FAQ, and transportation replies. Search, copy, and send accurate info fast." />
  <meta name="twitter:image" content="https://staging.mindobirdwatching.com/MBW-Assets-OG-Image.png" />

  <!-- Favicons (approved root paths) -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#034EA2">

  <link rel="stylesheet" href="/assets/css/site.css">
  <link rel="stylesheet" href="/assets/css/header.css?v=1">
  <script src="/assets/js/head.js" defer></script>

  <style>
    .page{ margin-top:18px; padding:26px; }
    .page.card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }

    .hero{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }

    h1{ margin:0 0 8px; letter-spacing:-0.02em; }

    .lede{
      margin:0;
      max-width: 92ch;
      color: var(--ink);
      line-height: 1.65;
    }

    .metaCard{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap:10px;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.55);
      font-weight: 900;
      color: var(--ink);
      font-size: 12.5px;
      line-height: 1;
      white-space: nowrap;
    }

    .note{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .pillRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .seg{
      display:inline-flex;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .seg button{
      appearance:none;
      border:0;
      background:transparent;
      padding: 10px 14px;
      font-weight: 950;
      font-size: 12.5px;
      color: var(--ink);
      cursor:pointer;
      line-height: 1;
      min-height: 40px;
    }

    .seg button[aria-pressed="true"]{
      background: rgba(3,78,162,.10);
      color: var(--forest);
    }

    .filters{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .filterPill{
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 8px 12px;
      display:flex;
      align-items:center;
      gap: 10px;
      min-height: 44px;
      box-sizing: border-box;
    }

    .filterPill label{
      font-weight: 900;
      font-size: 12.5px;
      color: var(--muted);
      white-space: nowrap;
    }

    .filterPill select,
    .filterPill input{
      border: 0;
      outline: 0;
      background: transparent;
      color: var(--ink);
      font-weight: 900;
      width: 100%;
      padding: 0;
      height: 28px;
      line-height: 28px;
      box-sizing: border-box;
      min-width: 0;
    }

    .section{
      margin-top:18px;
      padding-top:14px;
      border-top: 1px solid var(--line);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr .95fr;
      gap: 14px;
      align-items:start;
    }

    .list{
      display:grid;
      gap: 10px;
    }

    .itemBtn{
      width:100%;
      text-align:left;
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 12px 12px;
      cursor:pointer;
      display:grid;
      gap:6px;
    }

    .itemBtn[aria-current="true"]{
      outline: 2px solid rgba(3,78,162,.25);
      outline-offset: 0;
    }

    .itemTitle{
      margin:0;
      font-weight: 950;
      letter-spacing:-0.01em;
      color: var(--ink);
      font-size: 14px;
      line-height: 1.35;
    }

    .itemMeta{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
    }

    .detail{
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      padding: 14px;
      display:grid;
      gap: 12px;
      position: sticky;
      top: 92px;
    }

    .detail h2{
      margin:0;
      font-family: var(--font-head);
      color: var(--forest);
      letter-spacing:-0.02em;
      font-size: 18px;
      line-height: 1.25;
      font-weight: 950;
    }

    .block{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      padding: 12px;
      display:grid;
      gap: 8px;
    }

    .blockHead{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .blockTitle{
      margin:0;
      font-weight: 950;
      color: var(--ink);
      font-size: 13px;
      letter-spacing:-0.01em;
    }

    .copyBtn{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.65);
      box-shadow: var(--shadow);
      border-radius: 999px;
      padding: 8px 10px;
      font-weight: 950;
      font-size: 12.5px;
      cursor:pointer;
      line-height: 1;
    }

    .copyBtn:focus-visible{
      outline: 2px solid rgba(3,78,162,.35);
      outline-offset: 2px;
    }

    .txt{
      margin:0;
      color: var(--ink);
      line-height: 1.7;
      font-size: 14px;
      white-space: pre-wrap;
    }

    .linkRow{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .linkItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      padding: 10px 10px;
    }

    .linkLeft{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .icon{
      width: 26px;
      height: 26px;
      border-radius: 8px;
      display:block;
      object-fit: contain;
    }

    .linkLabel{
      margin:0;
      font-weight: 950;
      color: var(--ink);
      font-size: 13px;
      line-height: 1.2;
    }

    .linkUrl{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 52ch;
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 900;
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
      z-index: 9999;
    }
    .toast.show{ opacity: 1; }

    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .detail{ position: relative; top: 0; }
    }

    @media (max-width: 640px){
      .page{ padding:16px; margin-top:14px; }
      .filters{ grid-template-columns: 1fr; }
      .detail{ padding:12px; }
      .block{ padding: 10px; }
      .linkUrl{ max-width: 38ch; }
    }
  
    /* Promo image + social rows */
    .btnRow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .promoFigure{ margin:0; display:grid; gap:10px; }
    .promoImg{
      width:100%;
      height:auto;
      max-height: 320px;
      object-fit: contain;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
    }
    .promoHint{ margin:0; color: var(--muted); font-size: 12.5px; line-height: 1.45; }

    .socialGrid{ display:grid; gap:10px; }
    .socialRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 10px 10px;
      background: rgba(255,255,255,.55);
    }
    .socialLeft{ display:flex; gap:10px; align-items:center; min-width:0; }
    .socialIcon{ width:28px; height:28px; object-fit:contain; flex:0 0 auto; }
    .socialMeta{ min-width:0; }
    .socialName{ font-weight: 950; color: var(--ink); font-size: 14px; line-height: 1.2; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; }

    @media (max-width: 640px){
      .promoImg{ max-height: 240px; }
      .socialRow{ grid-template-columns: 1fr auto; padding: 10px; }
      .socialIcon{ width:26px; height:26px; }
    }
</style>
</head>
<body>
  <div class="container">
    <div id="siteHeader"></div>

    <main class="page card" aria-label="Staff info">
      <section class="hero" aria-label="Staff info introduction">
        <div>
          <h1 id="pageTitle">Staff Info</h1>
          <p class="lede" id="pageLede">
            Use filters to find the right answer fast. Copy and paste short or detailed replies to chat or email.
          </p>

          <div class="metaCard" aria-label="Controls">
            <div class="row">
              <div class="pillRow" aria-label="Language">
                <span class="chip">Language</span>
                <div class="seg" role="group" aria-label="Language toggle">
                  <button id="langEn" type="button" aria-pressed="true">English</button>
                  <button id="langEs" type="button" aria-pressed="false">Español</button>
                </div>
              </div>

              <div class="chips" aria-label="Status">
                <span class="chip" id="statusChip">Loading…</span>
              </div>
            </div>

            <div class="filters" aria-label="Filters">
              <div class="filterPill">
                <label for="subjectSel">Subject</label>
                <select id="subjectSel"></select>
              </div>

              <div class="filterPill">
                <label for="topicSel">Topic</label>
                <select id="topicSel"></select>
              </div>

              <div class="filterPill" style="grid-column: 1 / -1;">
                <label for="q">Search</label>
                <input id="q" type="search" placeholder="Search titles…" autocomplete="off" />
              </div>
            </div>

            <p class="note" id="h<script>
(function(){
  // ---------- helpers ----------
  const BASE_ORIGIN = window.location.origin;
  const DATA_URL = "./staff-content.json?v=" + Date.now();

  function $(id){ return document.getElementById(id); }
  function esc(s){
    return String(s ?? "")
      .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
  }

  const els = {
    subject: $("subject"),
    topic: $("topic"),
    search: $("search"),
    list: $("list"),
    detailTitle: $("detailTitle"),
    blocks: $("blocks"),
    count: $("count"),
    langPills: document.querySelectorAll("[data-lang-pill]"),
    bookingBtn: $("copyBookingLink")
  };

  function toast(msg){
    const el = $("toast");
    if(!el) return;
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(toast._t);
    toast._t = setTimeout(() => el.classList.remove("show"), 1600);
  }

  async function copyText(text){
    const t = String(text ?? "");
    try{
      if(navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(t);
        return true;
      }
    }catch(e){}
    // fallback
    try{
      const ta = document.createElement("textarea");
      ta.value = t;
      ta.setAttribute("readonly","");
      ta.style.position = "fixed";
      ta.style.top = "-9999px";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, ta.value.length);
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }catch(e){
      return false;
    }
  }

  function isProbablyImage(url){
    return /\.(png|jpe?g|webp|gif)(\?.*)?$/i.test(String(url||""));
  }

  function absUrl(pathOrUrl){
    const s = String(pathOrUrl || "");
    if(!s) return "";
    try{
      // If already absolute, URL() will keep it
      return new URL(s, BASE_ORIGIN).toString();
    }catch(e){
      return s;
    }
  }

  // ---------- data + state ----------
  const state = {
    lang: "en",
    db: null,
    currentItems: [],
    selectedId: null
  };

  const SOCIAL_ICON = {
    "Instagram": "/assets/images/icons/MBW-IG.png",
    "TikTok": "/assets/images/icons/MBW-Social-TikTok.png",
    "Facebook": "/assets/images/icons/MBW-Social-FB-01.png",
    "YouTube": "/assets/images/icons/MBW-Social-YouTube.png",
    "Shop": "/assets/images/icons/MBW-Social-Shopify.png",
    "Gift Shop": "/assets/images/icons/MBW-Social-Shopify.png",
    "Google Reviews": "/assets/images/icons/Google-Review-Symbol.png",
    "Google Review Link": "/assets/images/icons/Google-Review-Symbol.png"
  };

  function getLangBucket(){
    if(!state.db || !state.db.languages) return null;
    return state.db.languages[state.lang] || null;
  }

  function allSubjectsForLang(){
    const bucket = getLangBucket();
    if(!bucket) return [];
    return Object.keys(bucket).sort((a,b)=>a.localeCompare(b));
  }

  function topicsFor(subject){
    const bucket = getLangBucket();
    if(!bucket || !bucket[subject]) return [];
    return Object.keys(bucket[subject]).sort((a,b)=>a.localeCompare(b));
  }

  function itemsFor(subject, topic){
    const bucket = getLangBucket();
    if(!bucket || !bucket[subject] || !bucket[subject][topic]) return [];
    return bucket[subject][topic].map((it, idx) => ({...it, _subject: subject, _topic: topic, _id: it.id || (subject+"|"+topic+"|"+idx)}));
  }

  function computeBookingPath(){
    return state.lang === "es" ? "/es/reservar-tour/" : "/book-a-tour/";
  }

  function updateBookingButton(){
    if(!els.bookingBtn) return;
    const path = computeBookingPath();
    els.bookingBtn.textContent = state.lang === "es" ? "Copiar enlace de reserva" : "Copy booking link";
    els.bookingBtn.setAttribute("data-url", absUrl(path));
  }

  // ---------- render ----------
  function setLangUI(lang){
    state.lang = lang;
    els.langPills.forEach(p => {
      const on = p.getAttribute("data-lang-pill") === lang;
      p.classList.toggle("active", on);
      p.setAttribute("aria-pressed", on ? "true" : "false");
    });
    updateBookingButton();
    buildSubjectOptions();
    renderListAndDetail(true);
  }

  function buildSubjectOptions(){
    const subjects = allSubjectsForLang();
    if(!els.subject) return;

    els.subject.innerHTML = "";
    const ph = document.createElement("option");
    ph.value = "";
    ph.textContent = (state.lang === "es") ? "Selecciona" : "Select";
    els.subject.appendChild(ph);

    subjects.forEach(s => {
      const o = document.createElement("option");
      o.value = s;
      o.textContent = s;
      els.subject.appendChild(o);
    });

    // keep previous if exists
    const prev = subjects.includes(state._lastSubject) ? state._lastSubject : subjects[0] || "";
    els.subject.value = prev || "";
    buildTopicOptions();
  }

  function buildTopicOptions(){
    if(!els.topic) return;
    const subject = els.subject.value;
    state._lastSubject = subject;

    const topics = subject ? topicsFor(subject) : [];
    els.topic.innerHTML = "";
    const ph = document.createElement("option");
    ph.value = "";
    ph.textContent = (state.lang === "es") ? "Todos" : "All";
    els.topic.appendChild(ph);

    topics.forEach(t => {
      const o = document.createElement("option");
      o.value = t;
      o.textContent = t;
      els.topic.appendChild(o);
    });

    // select first topic by default to reduce clicks
    if(topics.length){
      els.topic.value = topics[0];
    }else{
      els.topic.value = "";
    }
  }

  function currentFilteredItems(){
    const subject = els.subject ? els.subject.value : "";
    const topic = els.topic ? els.topic.value : "";
    const q = (els.search ? els.search.value : "").trim().toLowerCase();

    let items = [];
    if(subject){
      if(topic){
        items = itemsFor(subject, topic);
      }else{
        topicsFor(subject).forEach(t => items = items.concat(itemsFor(subject, t)));
      }
    }else{
      // no subject selected: show nothing (keeps UI intentional)
      items = [];
    }

    if(q){
      items = items.filter(it => {
        const hay = (it.title || "") + " " + (it.subtitle || "") + " " + (it.message_short || "") + " " + (it.message_long || "");
        return hay.toLowerCase().includes(q);
      });
    }
    return items;
  }

  function renderListAndDetail(resetSelection){
    const items = currentFilteredItems();
    state.currentItems = items;

    if(els.count) els.count.textContent = String(items.length);

    if(els.list){
      if(!items.length){
        els.list.innerHTML = "<div class=\"empty\">" + esc(state.lang==="es" ? "No hay resultados." : "No results.") + "</div>";
      }else{
        els.list.innerHTML = items.map(it => {
          const active = it._id === state.selectedId;
          return (
            "<button class=\"item " + (active ? "active" : "") + "\" type=\"button\" data-item=\"" + esc(it._id) + "\">" +
              "<div class=\"itemTitle\">" + esc(it.title || "") + "</div>" +
              (it.subtitle ? "<div class=\"itemSub\">" + esc(it.subtitle) + "</div>" : "") +
            "</button>"
          );
        }).join("");
      }
    }

    if(resetSelection){
      state.selectedId = items[0] ? items[0]._id : null;
    }else{
      // keep selection if still exists
      if(state.selectedId && !items.some(it => it._id === state.selectedId)){
        state.selectedId = items[0] ? items[0]._id : null;
      }
    }

    renderDetail();
  }

  function renderDetail(){
    const it = state.currentItems.find(x => x._id === state.selectedId) || null;

    if(!it){
      if(els.detailTitle) els.detailTitle.textContent = state.lang === "es" ? "Selecciona un elemento" : "Select an item";
      if(els.blocks) els.blocks.innerHTML = "";
      return;
    }

    if(els.detailTitle) els.detailTitle.textContent = it.title || "";

    const parts = [];

    // Replies
    if(it.message_short){
      parts.push(
        "<div class=\"block\">" +
          "<div class=\"blockHead\"><h3>" + esc(state.lang==="es" ? "Respuesta corta" : "Short reply") + "</h3>" +
          "<button class=\"btn small\" type=\"button\" data-copy=\"" + esc(it.message_short) + "\">" + esc(state.lang==="es" ? "Copiar" : "Copy") + "</button></div>" +
          "<div class=\"blockBody\"><p>" + esc(it.message_short) + "</p></div>" +
        "</div>"
      );
    }

    if(it.message_long){
      parts.push(
        "<div class=\"block\">" +
          "<div class=\"blockHead\"><h3>" + esc(state.lang==="es" ? "Respuesta detallada" : "Detailed reply") + "</h3>" +
          "<button class=\"btn small\" type=\"button\" data-copy=\"" + esc(it.message_long) + "\">" + esc(state.lang==="es" ? "Copiar" : "Copy") + "</button></div>" +
          "<div class=\"blockBody\"><p>" + esc(it.message_long).replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>") + "</p></div>" +
        "</div>"
      );
    }

    // Promo image (uses source_url if it looks like an image)
    if(it.source_url && isProbablyImage(it.source_url)){
      const rel = it.source_url;
      const full = absUrl(rel);
      parts.push(
        "<div class=\"block\">" +
          "<div class=\"blockHead\"><h3>" + esc(state.lang==="es" ? "Imagen promocional" : "Promo image") + "</h3>" +
            "<div class=\"btnRow\">" +
              "<button class=\"btn small\" type=\"button\" data-copy=\"" + esc(full) + "\">" + esc(state.lang==="es" ? "Copiar enlace" : "Copy link") + "</button>" +
              "<a class=\"btn small secondary\" href=\"" + esc(full) + "\" target=\"_blank\" rel=\"noopener\">" + esc(state.lang==="es" ? "Abrir" : "Open") + "</a>" +
            "</div>" +
          "</div>" +
          "<div class=\"blockBody\">" +
            "<figure class=\"promoFigure\">" +
              "<img class=\"promoImg\" src=\"" + esc(rel) + "\" alt=\"" + esc(it.title || "Promo image") + "\" loading=\"lazy\" decoding=\"async\">" +
              "<figcaption class=\"promoHint\">" + esc(state.lang==="es" ? "Consejo: mantén presionada la imagen para copiar o compartir en móvil." : "Tip: press and hold the image to copy or share on mobile.") + "</figcaption>" +
            "</figure>" +
          "</div>" +
        "</div>"
      );
    }

    // Social links block
    if(state.db && state.db.globals && Array.isArray(state.db.globals.social_links) && state.db.globals.social_links.length){
      const links = state.db.globals.social_links;
      const rows = links.map(l => {
        const label = l.label || "";
        const url = l.url || "";
        const icon = SOCIAL_ICON[label] || "/assets/images/icons/MBW-IG.png";
        return (
          "<div class=\"socialRow\">" +
            "<div class=\"socialLeft\">" +
              "<img class=\"socialIcon\" src=\"" + esc(icon) + "\" alt=\"" + esc(label) + "\" loading=\"lazy\" decoding=\"async\">" +
              "<div class=\"socialMeta\"><div class=\"socialName\">" + esc(label) + "</div></div>" +
            "</div>" +
            "<button class=\"btn small\" type=\"button\" data-copy=\"" + esc(url) + "\">" + esc(state.lang==="es" ? "Copiar" : "Copy") + "</button>" +
          "</div>"
        );
      }).join("");

      parts.push(
        "<div class=\"block\">" +
          "<div class=\"blockHead\"><h3>" + esc(state.lang==="es" ? "Redes" : "Social links") + "</h3>" +
            "<button class=\"btn small secondary\" type=\"button\" data-copy-all-social=\"1\">" + esc(state.lang==="es" ? "Copiar todo" : "Copy all") + "</button>" +
          "</div>" +
          "<div class=\"blockBody\"><div class=\"socialGrid\">" + rows + "</div></div>" +
        "</div>"
      );
    }

    if(els.blocks) els.blocks.innerHTML = parts.join("");
  }

  // ---------- events ----------
  document.addEventListener("click", async function(e){
    const itemBtn = e.target.closest("[data-item]");
    if(itemBtn){
      state.selectedId = itemBtn.getAttribute("data-item");
      renderListAndDetail(false);
      return;
    }

    const copyBtn = e.target.closest("[data-copy]");
    if(copyBtn){
      const txt = copyBtn.getAttribute("data-copy") || "";
      const ok = await copyText(txt);
      toast(ok ? (state.lang==="es" ? "Copiado" : "Copied") : (state.lang==="es" ? "No se pudo copiar" : "Copy failed"));
      return;
    }

    const copyAll = e.target.closest("[data-copy-all-social]");
    if(copyAll && state.db && state.db.globals && Array.isArray(state.db.globals.social_links)){
      const text = state.db.globals.social_links.map(l => (l.label || "") + ": " + (l.url || "")).join("\n");
      const ok = await copyText(text);
      toast(ok ? (state.lang==="es" ? "Copiado" : "Copied") : (state.lang==="es" ? "No se pudo copiar" : "Copy failed"));
      return;
    }

    if(e.target && e.target.id === "copyBookingLink"){
      const url = e.target.getAttribute("data-url") || absUrl(computeBookingPath());
      const ok = await copyText(url);
      toast(ok ? (state.lang==="es" ? "Enlace copiado" : "Link copied") : (state.lang==="es" ? "No se pudo copiar" : "Copy failed"));
      return;
    }
  });

  if(els.subject){
    els.subject.addEventListener("change", function(){
      buildTopicOptions();
      renderListAndDetail(true);
    });
  }
  if(els.topic){
    els.topic.addEventListener("change", function(){
      renderListAndDetail(true);
    });
  }
  if(els.search){
    els.search.addEventListener("input", function(){
      renderListAndDetail(false);
    });
  }

  els.langPills.forEach(p => {
    p.addEventListener("click", function(){
      const lang = p.getAttribute("data-lang-pill");
      if(lang) setLangUI(lang);
    });
  });

  // ---------- init ----------
  (async function init(){
    try{
      // load data
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("Failed to load data");
      state.db = await res.json();

      // set default language (if only one exists, use it)
      const langs = state.db && state.db.languages ? Object.keys(state.db.languages) : ["en"];
      if(langs.includes("en")) state.lang = "en";
      else state.lang = langs[0] || "en";

      // build UI
      updateBookingButton();
      buildSubjectOptions();
      renderListAndDetail(true);

      // update loading pill if present
      const loadingPill = document.querySelector("[data-loading-pill]");
      if(loadingPill) loadingPill.remove();
    }catch(err){
      console.error(err);
      if(els.list) els.list.innerHTML = "<div class=\"empty\">" + esc(state.lang==="es" ? "Error cargando datos." : "Error loading data.") + "</div>";
      toast(state.lang==="es" ? "Error" : "Error");
    }
  })();
})();
</script>iv>" +
              "</div>" +
              "<button class='copyBtn' type='button' data-copy='" + esc(l.value || "") + "'>" + ((lang === "en") ? "Copy" : "Copiar") + "</button>" +
            "</div>"
          );
        }).join("");

        els.socialLinks.querySelectorAll("[data-copy]").forEach(btn => {
          btn.addEventListener("click", () => copyText(btn.getAttribute("data-copy")));
        });
      }

      async function init(){
        try{
          els.statusChip.textContent = "Loading…";
          const res = await fetch(DATA_URL, { cache: "no-store" });
          db = await res.json();
        }catch(_){
          els.statusChip.textContent = "Data failed to load";
          return;
        }

        // language buttons
        els.langEn.addEventListener("click", () => { lang = "en"; setLangUI(lang); updateLists(); renderSocial(); });
        els.langEs.addEventListener("click", () => { lang = "es"; setLangUI(lang); updateLists(); renderSocial(); });

        // filters
        els.subjectSel.addEventListener("change", () => updateLists());
        els.topicSel.addEventListener("change", () => updateLists());
        els.q.addEventListener("input", () => updateLists());

        setLangUI(lang);
        renderSocial();
        updateLists();
      }

      init();
    })();
  </script>
</body>
</html>
