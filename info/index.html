<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MBW Staff Info</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg: #f6f8fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --line: #e2e8f0;
      --brand: #034EA2;
      --shadow: 0 10px 24px rgba(2,6,23,0.08);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    .wrap {
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 14px 48px;
    }
    .top {
      display: grid;
      gap: 12px;
      margin-bottom: 12px;
    }
    .brandRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .titleBox h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.02em;
    }
    .titleBox p {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .pillRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 10px 12px;
      box-shadow: 0 4px 14px rgba(2,6,23,0.05);
    }
    .pill label {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    select, input[type="search"] {
      font: inherit;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 9px 10px;
      background: #fff;
      min-width: 180px;
      outline: none;
    }
    input[type="search"] { min-width: 260px; }
    .grid {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 920px) {
      .grid { grid-template-columns: 1fr; }
      input[type="search"] { min-width: 200px; width: 100%; }
      select { width: 100%; }
      .pill { width: 100%; justify-content: space-between; }
      .pillRow { width: 100%; }
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .panelHead {
      padding: 12px 12px 10px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .panelHead h2 {
      margin: 0;
      font-size: 14px;
      letter-spacing: -0.01em;
    }
    .panelBody {
      padding: 12px;
    }
    .btnRow {
      display: grid;
      gap: 8px;
    }
    .btn {
      width: 100%;
      text-align: left;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 650;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .btn small {
      font-weight: 600;
      color: var(--muted);
    }
    .btn[aria-pressed="true"] {
      border-color: rgba(3,78,162,0.35);
      background: rgba(3,78,162,0.06);
    }
    .subControls {
      display: grid;
      gap: 10px;
      padding: 12px;
      border-top: 1px solid var(--line);
      background: rgba(2,6,23,0.015);
    }
    .subControls .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .hint {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .resultsHead {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .count {
      color: var(--muted);
      font-size: 12px;
    }
    .cards {
      display: grid;
      gap: 10px;
      padding: 12px;
    }
    .card {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 8px 18px rgba(2,6,23,0.06);
    }
    .cardTop {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .card h3 {
      margin: 0;
      font-size: 14px;
      letter-spacing: -0.01em;
    }
    .meta {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .text {
      margin: 10px 0 0;
      white-space: pre-wrap;
      font-size: 13px;
      line-height: 1.45;
    }
    .actions {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .actionBtn {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
      font-weight: 650;
      font-size: 12px;
    }
    .actionBtn.primary {
      border-color: rgba(3,78,162,0.35);
      background: rgba(3,78,162,0.08);
      color: var(--brand);
    }

    .footerPanel {
      margin-top: 14px;
    }
    .socialGrid {
      display: grid;
      gap: 8px;
    }
    .socialItem {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 12px;
      padding: 10px 12px;
    }
    .socialItem .left {
      display: grid;
      gap: 2px;
    }
    .socialItem .label {
      font-weight: 700;
      font-size: 13px;
    }
    .socialItem .val {
      font-size: 12px;
      color: var(--muted);
      word-break: break-all;
    }
    .toast {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: 0.01em;
      opacity: 0;
      pointer-events: none;
      transition: opacity 180ms ease;
    }
    .toast.show { opacity: 1; }
    .err {
      color: #b91c1c;
      background: #fff;
      border: 1px solid rgba(185,28,28,0.25);
      padding: 10px 12px;
      border-radius: 12px;
    }
    a { color: var(--brand); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brandRow">
        <div class="titleBox">
          <h1>MBW Staff Info</h1>
          <p>Quick replies for tours, activities, transportation, and FAQs. Use the Copy buttons to paste into WhatsApp, SMS, email, or DM.</p>
        </div>
        <div class="pillRow">
          <div class="pill">
            <label for="lang">Language</label>
            <select id="lang">
              <option value="en">English</option>
              <option value="es">Espanol</option>
            </select>
          </div>
          <div class="pill">
            <label for="search">Search</label>
            <input id="search" type="search" placeholder="Search title or text" />
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panelHead">
          <h2>Subject</h2>
          <div class="count" id="subjectHint"></div>
        </div>
        <div class="panelBody">
          <div class="btnRow" id="subjectButtons"></div>
        </div>
        <div class="subControls" id="filters" hidden>
          <div class="row">
            <div class="hint" id="filterHint">Filter by topic and option.</div>
            <select id="topicSelect"></select>
            <select id="subtopicSelect" hidden></select>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHead resultsHead">
          <h2 id="resultsTitle">Results</h2>
          <div class="count" id="resultsCount"></div>
        </div>
        <div class="cards" id="cards">
          <div class="hint">Select a subject on the left.</div>
        </div>
      </div>
    </div>

    <div class="panel footerPanel">
      <div class="panelHead">
        <h2>Quick links to copy</h2>
        <div class="count">Social, review, shop</div>
      </div>
      <div class="panelBody">
        <div class="socialGrid" id="socialGrid"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Copied</div>

  <script>
    (function() {
      const state = {
        data: null,
        lang: "en",
        subject: null,
        topic: null,
        subtopic: null,
        search: ""
      };

      const el = (id) => document.getElementById(id);

      const langEl = el("lang");
      const searchEl = el("search");
      const subjectButtonsEl = el("subjectButtons");
      const subjectHintEl = el("subjectHint");
      const filtersEl = el("filters");
      const topicSelectEl = el("topicSelect");
      const subtopicSelectEl = el("subtopicSelect");
      const cardsEl = el("cards");
      const resultsTitleEl = el("resultsTitle");
      const resultsCountEl = el("resultsCount");
      const socialGridEl = el("socialGrid");
      const toastEl = el("toast");

      function toast(msg) {
        toastEl.textContent = msg || "Copied";
        toastEl.classList.add("show");
        setTimeout(() => toastEl.classList.remove("show"), 900);
      }

      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          toast("Copied");
        } catch (e) {
          // Fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          toast("Copied");
        }
      }

      function normalize(s) {
        return (s || "").toString().toLowerCase();
      }

      function getLangData() {
        if (!state.data) return null;
        return state.data.languages[state.lang] || null;
      }

      function listSubjects() {
        const langData = getLangData();
        if (!langData) return [];
        return Object.keys(langData);
      }

      function setSubject(subj) {
        state.subject = subj;
        state.topic = null;
        state.subtopic = null;
        renderSubjects();
        renderFilters();
        renderCards();
      }

      function setTopic(topic) {
        state.topic = topic;
        state.subtopic = null;
        renderFilters();
        renderCards();
      }

      function setSubtopic(st) {
        state.subtopic = st || null;
        renderCards();
      }

      function getSubjectData() {
        const langData = getLangData();
        if (!langData || !state.subject) return null;
        return langData[state.subject] || null;
      }

      function listTopics() {
        const subj = getSubjectData();
        if (!subj) return [];
        return Object.keys(subj);
      }

      function listItems() {
        const subj = getSubjectData();
        if (!subj) return [];
        const topic = state.topic || listTopics()[0];
        if (!topic) return [];
        const items = subj[topic] || [];
        return items;
      }

      function listSubtopics(items) {
        const set = new Set();
        for (const it of items) {
          if (it.subtopic) set.add(it.subtopic);
        }
        return Array.from(set).sort((a,b) => a.localeCompare(b));
      }

      function renderSubjects() {
        const subjects = listSubjects();
        subjectHintEl.textContent = subjects.length ? subjects.length + " subjects" : "";
        subjectButtonsEl.innerHTML = "";
        for (const subj of subjects) {
          const btn = document.createElement("button");
          btn.className = "btn";
          btn.type = "button";
          btn.setAttribute("aria-pressed", state.subject === subj ? "true" : "false");
          btn.innerHTML = "<span>" + subj + "</span><small>></small>";
          btn.addEventListener("click", () => setSubject(subj));
          subjectButtonsEl.appendChild(btn);
        }
      }

      function renderFilters() {
        const subj = getSubjectData();
        if (!subj) {
          filtersEl.hidden = true;
          topicSelectEl.innerHTML = "";
          subtopicSelectEl.hidden = true;
          subtopicSelectEl.innerHTML = "";
          return;
        }

        filtersEl.hidden = false;

        const topics = listTopics();
        const currentTopic = state.topic || topics[0] || null;
        state.topic = currentTopic;

        topicSelectEl.innerHTML = "";
        for (const t of topics) {
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = t;
          if (t === currentTopic) opt.selected = true;
          topicSelectEl.appendChild(opt);
        }

        const items = listItems();
        const subtopics = listSubtopics(items);

        if (subtopics.length > 1) {
          subtopicSelectEl.hidden = false;
          subtopicSelectEl.innerHTML = "";
          const allOpt = document.createElement("option");
          allOpt.value = "";
          allOpt.textContent = "All options";
          subtopicSelectEl.appendChild(allOpt);

          for (const st of subtopics) {
            const opt = document.createElement("option");
            opt.value = st;
            opt.textContent = st;
            if (state.subtopic === st) opt.selected = true;
            subtopicSelectEl.appendChild(opt);
          }
        } else {
          state.subtopic = null;
          subtopicSelectEl.hidden = true;
          subtopicSelectEl.innerHTML = "";
        }
      }

      function bestCopyText(item) {
        // FAQ: only copy the answer (message_long)
        const isFAQ = state.subject === "Questions" || normalize(item.topic).includes("faq");
        if (isFAQ) return (item.message_long || item.message_short || item.title || "").trim();

        // Everything else: prefer long; fallback to short; fallback to title.
        return (item.message_long || item.message_short || item.title || "").trim();
      }

      function matchesSearch(item) {
        if (!state.search) return true;
        const q = normalize(state.search);
        const blob = [
          item.title,
          item.subtopic,
          item.message_short,
          item.message_long,
          item.source_url
        ].map(normalize).join(" ");
        return blob.includes(q);
      }

      function renderCards() {
        if (!state.subject) {
          resultsTitleEl.textContent = "Results";
          resultsCountEl.textContent = "";
          cardsEl.innerHTML = '<div class="hint">Select a subject on the left.</div>';
          return;
        }

        const items = listItems().filter((it) => {
          if (state.subtopic && it.subtopic !== state.subtopic) return false;
          if (!matchesSearch(it)) return false;
          return true;
        });

        resultsTitleEl.textContent = state.subject + " - " + (state.topic || "");
        resultsCountEl.textContent = items.length + " items";

        if (!items.length) {
          cardsEl.innerHTML = '<div class="hint">No matches. Try clearing Search or changing filters.</div>';
          return;
        }

        cardsEl.innerHTML = "";
        for (const item of items) {
          const card = document.createElement("div");
          card.className = "card";

          const title = item.title || "Untitled";
          const metaBits = [];
          if (item.subtopic) metaBits.push(item.subtopic);
          if (item.topic) metaBits.push(item.topic);

          const displayText = item.message_short || "";
          const link = item.source_url || "";

          card.innerHTML = `
            <div class="cardTop">
              <div>
                <h3>${escapeHtml(title)}</h3>
                <div class="meta">${escapeHtml(metaBits.join(" | "))}</div>
              </div>
            </div>
            <div class="text">${escapeHtml(displayText)}</div>
            <div class="actions"></div>
          `;

          const actions = card.querySelector(".actions");

          const copyBtn = document.createElement("button");
          copyBtn.className = "actionBtn primary";
          copyBtn.type = "button";
          copyBtn.textContent = "Copy reply";
          copyBtn.addEventListener("click", () => copyToClipboard(bestCopyText(item)));
          actions.appendChild(copyBtn);

          if (item.message_long && item.message_long !== item.message_short) {
            const copyFullBtn = document.createElement("button");
            copyFullBtn.className = "actionBtn";
            copyFullBtn.type = "button";
            copyFullBtn.textContent = "Copy full";
            copyFullBtn.addEventListener("click", () => copyToClipboard((item.message_long || "").trim()));
            actions.appendChild(copyFullBtn);
          }

          if (link) {
            const copyLinkBtn = document.createElement("button");
            copyLinkBtn.className = "actionBtn";
            copyLinkBtn.type = "button";
            copyLinkBtn.textContent = "Copy link";
            copyLinkBtn.addEventListener("click", () => copyToClipboard(link));
            actions.appendChild(copyLinkBtn);

            const openBtn = document.createElement("a");
            openBtn.className = "actionBtn";
            openBtn.href = link;
            openBtn.target = "_blank";
            openBtn.rel = "noopener";
            openBtn.textContent = "Open";
            actions.appendChild(openBtn);
          }

          cardsEl.appendChild(card);
        }
      }

      function renderSocial() {
        socialGridEl.innerHTML = "";
        const list = (state.data && state.data.globals && state.data.globals.social_links) ? state.data.globals.social_links : [];
        for (const it of list) {
          const row = document.createElement("div");
          row.className = "socialItem";
          row.innerHTML = `
            <div class="left">
              <div class="label">${escapeHtml(it.label)}</div>
              <div class="val">${escapeHtml(it.value)}</div>
            </div>
            <div class="right">
              <button type="button" class="actionBtn primary">Copy</button>
            </div>
          `;
          row.querySelector("button").addEventListener("click", () => copyToClipboard(it.value));
          socialGridEl.appendChild(row);
        }
      }

      function escapeHtml(str) {
        return (str || "").toString()
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function onLangChange() {
        state.lang = langEl.value;
        state.subject = null;
        state.topic = null;
        state.subtopic = null;
        renderSubjects();
        renderFilters();
        renderCards();
      }

      function onSearchChange() {
        state.search = searchEl.value || "";
        renderCards();
      }

      async function init() {
        try {
          const res = await fetch("./staff-content.json", { cache: "no-store" });
          if (!res.ok) throw new Error("Failed to load staff-content.json");
          state.data = await res.json();
        } catch (e) {
          cardsEl.innerHTML = '<div class="err">Could not load staff-content.json. Make sure staff-content.json is in the same folder as index.html.</div>';
          return;
        }

        // Default language
        langEl.value = state.lang;

        renderSubjects();
        renderFilters();
        renderCards();
        renderSocial();

        langEl.addEventListener("change", onLangChange);
        searchEl.addEventListener("input", onSearchChange);

        topicSelectEl.addEventListener("change", () => setTopic(topicSelectEl.value));
        subtopicSelectEl.addEventListener("change", () => setSubtopic(subtopicSelectEl.value));
      }

      init();
    })();
  </script>
</body>
</html>
